package edu.nju.data;

import edu.nju.entity.SecRepoEntity;
import org.hibernate.Query;
import org.hibernate.Session;
import org.hibernate.SessionFactory;
import org.json.JSONArray;
import org.json.JSONObject;
import org.springframework.stereotype.Repository;
import weka.core.Attribute;
import weka.core.DenseInstance;
import weka.core.Instance;
import weka.core.Instances;
import weka.core.converters.ArffSaver;
import weka.core.json.JSONNode;
import weka.experiment.InstanceQuery;

import javax.annotation.Resource;
import java.io.File;
import java.io.IOException;
import java.util.ArrayList;
import java.util.List;

/**
 * generate arff file for weka package
 * @author cuihao
 */
@Repository
public class ARFFGenerator {

    @Resource
    private SessionFactory sessionFactory;

    /**
     * generate weka dataSource file
     * @param instances weka Instances
     */
    public void generateArffFile(Instances instances, String path) {
        ArffSaver saver = new ArffSaver();
        saver.setInstances(instances);
        try {
            saver.setFile(new File(path));
            saver.writeBatch();
        } catch (IOException e) {
            e.printStackTrace();
        }
    }

    /**
     * generate instances from database
     * === Run information ===

     Scheme:       weka.classifiers.functions.MultilayerPerceptron -L 0.3 -M 0.2 -N 500 -V 0 -S 0 -E 20 -H a -R
     Relation:     repo_popular
     Instances:    45723
     Attributes:   6
     fork
     size
     sum
     avg
     weight
     star
     Test mode:    10-fold cross-validation

     === Classifier model (full training set) ===

     Linear Node 0
     Inputs    Weights
     Threshold    -1.1123887947275672
     Node 1    0.6596485082393743
     Node 2    2.451730279313244
     Node 3    1.6151656848854097
     Sigmoid Node 1
     Inputs    Weights
     Threshold    25.839806193924616
     Attrib fork    52.71725971820234
     Attrib size    -3.0552344347469726
     Attrib sum    -58.753921720365454
     Attrib avg    -122.22118288659625
     Attrib weight    160.37098347026202
     Sigmoid Node 2
     Inputs    Weights
     Threshold    -5.482052699953215
     Attrib fork    0.5846582881884442
     Attrib size    -0.7869252790178127
     Attrib sum    -1.1953236693005755
     Attrib avg    2.142161391070926
     Attrib weight    -1.3459363732147966
     Sigmoid Node 3
     Inputs    Weights
     Threshold    24.733163682062397
     Attrib fork    51.05651559222434
     Attrib size    -24.5627383596819
     Attrib sum    0.8719819728449698
     Attrib avg    2.133501000425092
     Attrib weight    -1.5291055608296875
     Class
     Input
     Node 0


     Time taken to build model: 14.71 seconds

     === Cross-validation ===
     === Summary ===

     Correlation coefficient                  0.2692
     Mean absolute error                      0.1448
     Root mean squared error                  0.2713
     Relative absolute error                 97.7075 %
     Root relative squared error             99.6564 %
     Total Number of Instances            45723


     * @param start first index of repos
     * @param max max number of repos
     * @return instances
     */
    public Instances generatePopularInstanceFromDB(int start, int max) {
        List<SecRepoEntity> secRepoEntities = getRepoEntities(start, max);
        return generatePopularInstance(secRepoEntities);
    }

    /**
     * generate activity instances from database
     * === Run information ===

     Scheme:       weka.clusterers.SimpleKMeans -init 0 -max-candidates 100 -periodic-pruning 10000 -min-density 2.0 -t1 -1.25 -t2 -1.0 -N 5 -A "weka.core.EuclideanDistance -R first-last" -I 500 -num-slots 1 -S 10
     Relation:     repo_activity
     Instances:    94961
     Attributes:   364
     [list of attributes omitted]
     Test mode:    evaluate on training data


     === Clustering model (full training set) ===


     kMeans
     ======

     Number of iterations: 37
     Within cluster sum of squared errors: 896.6002516228036

     Initial starting points (random):

     Cluster 0: 0,0,0,0,0,0,0,0,0,3,0,0,1,0,4,0,0,0,0,0,0,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,1,0,0,0,2,9,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,6,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
     Cluster 1: 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,0,4,2,3,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
     Cluster 2: 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
     Cluster 3: 0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1,0,2,0,0,0,0,0,3,2,0,2,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
     Cluster 4: 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0

     Missing values globally replaced with mean/mode

     Final cluster centroids:
     Cluster#
     Attribute   Full Data         0         1         2         3         4
     (94961.0)     (2.0)   (113.0) (94024.0)     (7.0)   (815.0)
     =======================================================================
     day0           0.0733      37.5     6.469    0.0349   71.1429    2.9104
     day1           0.1072        90        10    0.0519   73.7143    4.2663
     day2            0.146       228   13.2655    0.0701   97.4286    5.6933
     day3           0.1455     221.5   14.3982    0.0677   67.7143     6.016
     day4           0.1406     176.5   12.7876    0.0681   79.8571    5.6344
     day5           0.1356     142.5   11.5841    0.0639  114.4286    5.4859
     day6           0.0703        38    6.2035    0.0358   89.2857     2.335
     day7           0.0748        39    6.3894    0.0373       105    2.5215
     day8           0.1367     204.5   12.2301     0.062  114.7143    5.5914
     day9           0.1406     217.5   14.5575    0.0624        78    5.9595
     day10          0.1374     255.5   12.7965    0.0628   77.5714    5.7055
     day11          0.1346       182   12.1416    0.0635   69.1429    5.6356
     day12          0.1283       246   12.0619    0.0604   74.7143     5.065
     day13          0.0684        46    6.7876    0.0345   66.2857    2.3644
     day14          0.0824     124.5    7.7257    0.0375  121.8571    2.8564
     day15          0.1489       303   11.3451    0.0673  168.2857    5.8221
     day16          0.1539     269.5   13.4336    0.0618  177.7143    6.7485
     day17           0.155     218.5   15.9646    0.0622  172.4286    6.6589
     day18          0.1443     237.5   13.3805    0.0573  190.7143    6.1252
     day19          0.1249     181.5   10.6637    0.0534        78    5.7963
     day20          0.0703      53.5    6.8761    0.0336   41.1429    2.8761
     day21          0.0664      46.5    6.3982    0.0321   47.4286    2.6233
     day22          0.1298       210   12.1593    0.0564   89.7143    5.6368
     day23           0.129     203.5   12.8496    0.0552   80.7143    5.6834
     day24          0.1238     263.5    10.708    0.0521   94.5714    5.4663
     day25          0.1219       227   11.1416    0.0514        66    5.6098
     day26          0.1177     214.5   10.4779    0.0476   90.4286     5.465
     day27          0.0691      75.5    6.3363    0.0327   56.4286     2.735
     day28           0.074      50.5    5.9469     0.036   62.2857    2.9877
     day29          0.1295       246   12.4956    0.0562   99.7143    5.4221
     day30           0.133       169   15.2124    0.0565   77.7143     5.789
     day31          0.1329       195   13.9469    0.0571   90.2857    5.7043
     day32          0.1371     227.5   15.1416    0.0597   74.8571    5.7853
     day33          0.1208     185.5   15.0885    0.0497   75.5714    5.1411
     day34           0.071      45.5    7.9558    0.0322   49.1429    2.9264
     day35          0.0757        45    8.0708    0.0332   66.7143    3.1914
     day36          0.1295       251   14.2212    0.0517  131.4286     5.416
     day37          0.1438       249   17.1327    0.0593   71.8571    6.3129
     day38           0.144       227   15.2478    0.0609  147.5714    5.8135
     day39          0.1332       293   13.5044    0.0573   92.2857    5.5325
     day40           0.123     236.5   13.1239    0.0517  102.1429    5.0896
     day41          0.0761        53    9.4513    0.0344   72.2857    2.8405
     day42          0.0793      67.5    8.0265    0.0384   67.2857    2.9534
     day43          0.1306       214   13.7257    0.0538  100.7143    5.7227
     day44          0.1297     249.5   14.3363    0.0516   78.1429    5.8896
     day45          0.1306       224   12.8053    0.0553   82.1429       5.8
     day46          0.1279     244.5   12.9027    0.0526  128.5714    5.3387
     day47          0.1269       155   12.2743    0.0485  187.7143    5.5031
     day48          0.0685        44    6.0177    0.0317   48.1429    2.9644
     day49          0.0666      82.5    7.3274    0.0296   58.4286    2.6184
     day50          0.1217       214   13.4956    0.0499   93.8571    5.2282
     day51          0.1309     257.5   14.4602    0.0531   74.7143    5.8479
     day52          0.1304       264   15.7965    0.0498   76.2857    5.9595
     day53          0.1257       261   12.9292    0.0493   79.5714    5.8417
     day54           0.127     179.5   13.3186    0.0456   87.7143    6.4994
     day55           0.069        32    7.2743    0.0291   62.7143    3.0528
     day56          0.0723      38.5     7.708    0.0301  103.2857    2.8969
     day57          0.1204     136.5    12.646    0.0475   97.7143    5.6282
     day58          0.1306     218.5   14.1593    0.0508   82.8571    6.1448
     day59          0.1307     257.5   14.5221    0.0504   82.4286     6.054
     day60          0.1175       333   11.7611    0.0477   74.4286    5.1006
     day61          0.1122     262.5   13.4071    0.0452   72.8571    4.7288
     day62          0.0686      29.5    7.0177    0.0303   53.4286     2.989
     day63          0.0739      58.5    7.9646     0.031   69.5714    3.1914
     day64          0.1183       178   11.8761    0.0474   79.7143    5.5448
     day65          0.1206       171   13.8673    0.0465   88.7143    5.5902
     day66          0.1207     238.5   12.8496    0.0472       103    5.3693
     day67          0.1198     194.5   13.0973    0.0446   89.8571    5.7472
     day68          0.1053       198   12.0796    0.0413   54.1429    4.8785
     day69          0.0633        39    7.5841    0.0272   35.4286    2.7877
     day70          0.0649      40.5     6.177    0.0309   50.1429    2.6123
     day71          0.1186     242.5   13.9469    0.0454   67.2857    5.4699
     day72          0.1249       249   13.8673    0.0498        58    5.7718
     day73          0.1282       281    15.469    0.0497        56    5.8908
     day74          0.1293     286.5   14.1416    0.0496   70.5714    6.0761
     day75           0.115       234        15    0.0446   56.1429    5.1215
     day76          0.0624      82.5    6.6637    0.0272        27    2.7791
     day77          0.0573      35.5    7.3363    0.0244   31.1429    2.4908
     day78          0.1152     221.5   13.9646    0.0456        39    5.3472
     day79          0.1137       205   13.1062    0.0453   58.4286    5.2037
     day80          0.1051       207   13.1327    0.0415   52.5714    4.6736
     day81          0.0817       142     9.531    0.0309   60.4286    3.7607
     day82          0.0805     131.5    7.9558    0.0324        62    3.6822
     day83           0.057        36    6.4779    0.0219   33.8571    2.8393
     day84           0.056        36    7.4956    0.0231   40.4286    2.3865
     day85          0.1161       281   14.4779    0.0475   46.4286    4.9534
     day86          0.1218     283.5   15.2389    0.0461   59.5714    5.5571
     day87          0.1178       220   15.2124    0.0449   67.2857     5.319
     day88          0.1194       241   17.9204    0.0434   50.7143    5.3939
     day89          0.1069     224.5   16.9646    0.0379        56    4.6994
     day90          0.0713        41    8.2743     0.027   34.8571    3.6528
     day91          0.0712        50    8.1416    0.0288   39.8571    3.3828
     day92          0.1149     183.5   16.0177    0.0434   42.7143    5.3423
     day93          0.1105     230.5   16.1593    0.0399   52.5714    5.0147
     day94          0.1129     215.5   16.7788    0.0415   50.1429     5.081
     day95           0.112     244.5   16.0442    0.0398        57    5.1448
     day96          0.1011       249   14.4336    0.0366   36.5714    4.6368
     day97          0.0581        53    8.9823     0.023   28.7143    2.4969
     day98          0.0627        50   10.6814    0.0252   30.2857    2.5337
     day99          0.1088     276.5   15.6549    0.0402   69.2857    4.5926
     day100         0.1187     254.5   17.3894    0.0444   35.7143     5.362
     day101         0.1128     267.5   16.4071    0.0423        63    4.7951
     day102         0.1075     271.5   16.3363    0.0401        70    4.3706
     day103          0.099     200.5        15    0.0346   82.1429    4.2687
     day104         0.0528      44.5     8.292    0.0203        61    2.0258
     day105         0.0521      51.5    8.6018    0.0201   24.4286    2.2245
     day106          0.098     260.5   13.5575    0.0367        47    4.2601
     day107         0.0969       230   16.2212    0.0343   60.4286    4.0012
     day108         0.0791       201   11.7611    0.0296   48.2857    3.2589
     day109         0.0507        71    7.6726     0.018        34    2.2994
     day110         0.0374      20.5    5.6726    0.0147   20.1429    1.6479
     day111         0.0445        35    6.8673    0.0186   35.1429    1.6957
     day112         0.0471      45.5    8.6283    0.0205   34.7143    1.5239
     day113          0.073     109.5   12.4425    0.0286   26.5714    2.9865
     day114         0.0825       152   12.7699    0.0331   36.7143    3.3252
     day115         0.0772     152.5   11.7611      0.03   23.5714    3.3276
     day116         0.0583        61    8.7257    0.0247   16.2857    2.4454
     day117         0.0439        32    7.3628    0.0195   17.5714    1.6135
     day118         0.0534      33.5    8.3628    0.0247   17.4286     1.984
     day119         0.0735      90.5   20.2301    0.0248   22.7143    2.4834
     day120         0.0914       233   14.8319    0.0343   26.7143    3.8258
     day121         0.1013     265.5   14.2035    0.0396   30.8571    4.3583
     day122         0.1057     228.5   18.1504    0.0373   39.5714    4.5939
     day123         0.0954     226.5   15.1416    0.0358   23.5714    4.1227
     day124          0.088       163   15.2566    0.0336   32.1429     3.589
     day125         0.0584        55   10.3628    0.0244        30    2.1595
     day126         0.0542      44.5     8.115    0.0232   21.8571    2.2258
     day127         0.1013     225.5   16.7699    0.0369   27.1429    4.4258
     day128         0.1079       239    23.115    0.0385   28.8571    4.0896
     day129         0.0963     272.5    14.885    0.0375   25.7143     3.946
     day130         0.1013       307   15.9735     0.039   49.5714    3.9031
     day131         0.1019       248   14.9558    0.0414   45.5714    4.0245
     day132         0.0544      52.5    7.1504    0.0259   21.8571    2.0528
     day133         0.0605      63.5    8.7788    0.0296   29.7143    2.0061
     day134         0.0865       196   12.1681    0.0385   19.4286    3.2933
     day135          0.097     239.5   13.7965    0.0399   30.2857    3.9374
     day136         0.0967       272   14.2301    0.0397   18.5714    3.8834
     day137         0.0954       292   14.3982    0.0368   19.8571    3.9914
     day138          0.088       229   12.5929    0.0347   18.4286    3.7791
     day139         0.0508      30.5    8.0973    0.0223   12.1429    2.0454
     day140         0.0529      55.5    8.5929    0.0225   14.1429    2.1104
     day141         0.0938       302   13.6991    0.0359   20.4286    3.9706
     day142         0.0883       303   13.5929    0.0349   13.7143    3.5129
     day143         0.0909       277   13.1327    0.0356   17.8571    3.8282
     day144         0.0892     322.5   11.9823    0.0365   20.2857     3.562
     day145         0.0824     250.5   11.0619    0.0334   19.7143    3.4245
     day146          0.053        56    6.7345    0.0248   25.4286    2.0294
     day147         0.0535        37    8.0442    0.0261   21.2857    1.8344
     day148         0.0909     200.5   13.4513    0.0379   15.4286     3.735
     day149         0.0916     293.5   13.8761    0.0382   17.1429    3.4699
     day150         0.0955       367   13.4867    0.0383   15.1429    3.8098
     day151         0.0828       325   11.2743    0.0348   22.7143    3.0859
     day152         0.0779     288.5   10.6726    0.0329   18.5714    2.9362
     day153         0.0496      60.5         7     0.023   18.4286    1.8405
     day154          0.051      45.5    6.6372    0.0258        12    1.8282
     day155         0.0818       235   11.3717    0.0348   15.4286    3.2331
     day156          0.085     294.5   14.0796    0.0348   14.8571     3.081
     day157          0.087       309    12.531     0.035   23.2857       3.4
     day158         0.0823       292   11.9735    0.0326   26.1429     3.227
     day159         0.0774     261.5   11.7788    0.0322   13.8571    2.9092
     day160         0.0457        42    5.7699    0.0227   16.1429    1.6736
     day161         0.0454        72    6.3009    0.0227   13.7143     1.508
     day162         0.0724     274.5    9.6903    0.0319        20    2.5706
     day163         0.0826     310.5   11.3009    0.0362   21.4286    2.9399
     day164         0.0829     311.5   11.7168    0.0347   27.8571    3.0356
     day165         0.0852     272.5    13.177    0.0362        28    3.0123
     day166         0.0814       265   12.5664    0.0352   26.5714    2.7963
     day167         0.0456      51.5    7.0619    0.0223   18.4286    1.4687
     day168         0.0484      48.5    7.3097    0.0245        16    1.5399
     day169         0.0835     322.5   12.7965    0.0337   30.5714     3.016
     day170         0.0828       254   13.1327    0.0354        54    2.6564
     day171         0.0859       340   13.2124    0.0345   41.8571    2.9988
     day172         0.0834     280.5    12.469    0.0353   25.7143    3.0037
     day173         0.0775       319   12.4336    0.0318   14.2857    2.7313
     day174         0.0443      31.5    5.6637    0.0221   16.2857     1.616
     day175         0.0493      87.5    5.7168     0.025   37.7143    1.5374
     day176         0.0731     275.5   10.0796    0.0328   13.8571    2.5387
     day177          0.079       296   11.0177    0.0339   32.2857    2.7644
     day178         0.0815     281.5   12.2212    0.0354        26    2.8061
     day179         0.0819       311   12.2301    0.0348   29.1429    2.8135
     day180         0.0728       224   10.5044    0.0335   14.8571    2.4871
     day181          0.043      71.5    5.1239    0.0219   13.2857    1.4785
     day182          0.047      56.5    6.5929     0.024   20.1429    1.4712
     day183         0.0728     247.5   11.3097    0.0337   23.1429    2.2196
     day184          0.073       274   11.0088     0.031   19.2857    2.5706
     day185         0.0785     367.5   11.7434    0.0311   24.7143    2.8233
     day186         0.0781       364   11.7257    0.0309        27    2.7742
     day187         0.0718       213   10.2301    0.0299        27    2.7362
     day188         0.0374      38.5    4.5929    0.0205   15.8571    1.1276
     day189         0.0415        47    5.6106    0.0222   17.1429    1.2307
     day190         0.0668       192   10.2743    0.0303   13.4286    2.2687
     day191          0.069       250   11.3186    0.0287        22    2.3571
     day192         0.0717     242.5   10.7788    0.0321   23.1429    2.3669
     day193         0.0733     248.5   12.7876    0.0307   22.5714    2.4282
     day194         0.0666     198.5   15.0088    0.0273        23     1.854
     day195          0.041      44.5    5.3097    0.0218   18.4286    1.2552
     day196         0.0462     186.5    6.3451    0.0213   16.2857    1.4466
     day197         0.0738     507.5    9.9204    0.0311   16.4286    2.2503
     day198           0.07       344    9.5929    0.0322   17.1429     2.119
     day199         0.0697     252.5    9.7434    0.0294   18.5714    2.6037
     day200         0.0644     184.5    9.9292    0.0287   17.7143    2.2086
     day201         0.0569     107.5    7.8053    0.0257   24.7143    2.1031
     day202         0.0371        46    5.0885    0.0194   16.4286    1.1166
     day203         0.0345        27    3.0973      0.02   12.2857    1.1141
     day204         0.0563     175.5    8.2566    0.0252        17    1.9337
     day205          0.065       214    8.3186    0.0294        17    2.3644
     day206         0.0674       406    8.6814     0.028   19.5714    2.2491
     day207         0.0635       226    8.2389    0.0285   21.8571    2.2282
     day208         0.0576       223    8.4779    0.0251   19.4286    1.9178
     day209         0.0336      33.5    3.7965    0.0184   13.1429    1.0724
     day210          0.034        35    4.0265    0.0166   12.2857    1.2969
     day211         0.0559       166    8.0265    0.0261   13.2857    1.8626
     day212         0.0545       175    8.2478    0.0245   12.5714    1.8466
     day213         0.0611       179     9.469    0.0285   12.1429    1.9816
     day214         0.0563     176.5    7.7965    0.0267        17    1.8196
     day215         0.0513     159.5    7.2478    0.0251    7.4286    1.6221
     day216         0.0396        38    3.6018    0.0225   66.2857    0.8503
     day217         0.0388      37.5    3.6637     0.021   57.7143    1.0037
     day218         0.0519     173.5    7.3628    0.0241   30.1429    1.5718
     day219         0.0541     195.5    8.4159    0.0248   11.2857    1.6982
     day220         0.0516       207    7.3805    0.0238   13.5714    1.6282
     day221         0.0563     210.5    7.9469    0.0272   21.4286    1.6172
     day222         0.0503       164    6.6637     0.025        31    1.3902
     day223         0.0312        27    4.5133    0.0189   10.2857    0.6675
     day224         0.0314      44.5    3.5575    0.0184   18.1429    0.7779
     day225         0.0531       208    5.9823    0.0276        29    1.4172
     day226          0.056       206    7.4336    0.0274   15.2857     1.692
     day227         0.0571     229.5    7.5929    0.0286   13.1429     1.616
     day228         0.0531       220    7.7965    0.0254   12.1429    1.5325
     day229         0.0481       183    7.9735     0.023    6.7143     1.335
     day230         0.0285        27    4.1947    0.0156    9.1429    0.7926
     day231          0.028        52    3.8584    0.0158    6.7143    0.7178
     day232         0.0485       214    5.9912    0.0249    7.4286    1.3681
     day233         0.0476       256    5.8673    0.0236    4.4286    1.3374
     day234         0.0479       216    5.6018    0.0248    5.2857    1.3681
     day235         0.0473       228    6.0973    0.0233    4.7143    1.3804
     day236         0.0452     234.5    6.7965    0.0221    6.1429    1.1387
     day237         0.0268        42    3.8673    0.0142    4.4286       0.8
     day238         0.0286        46    3.7611    0.0177         3    0.6344
     day239         0.0421     146.5    5.9646    0.0205    7.8571     1.281
     day240         0.0458     254.5    6.2124    0.0204   10.8571    1.3988
     day241         0.0443       219    6.8053    0.0224        15    0.9706
     day242         0.0413     189.5     5.354    0.0206   13.4286    1.1117
     day243         0.0385       172    5.2124    0.0203    8.1429    0.9301
     day244         0.0216      26.5    3.1858    0.0125         5    0.5239
     day245         0.0228      23.5    3.7345    0.0127    8.2857    0.5337
     day246         0.0426       197    8.3009    0.0196    7.2857    1.0012
     day247         0.0427       208    6.1593    0.0211   11.5714    1.0773
     day248         0.0416     220.5    5.5929    0.0206    8.8571    1.0859
     day249         0.0376     182.5    4.7434    0.0189    5.8571     1.038
     day250         0.0398       230    4.5841    0.0192    6.4286    1.1669
     day251         0.0209      23.5    3.1593     0.012   11.2857    0.4638
     day252         0.0216      25.5    3.1593    0.0131    7.8571    0.4442
     day253         0.0374     124.5    5.7699    0.0203    8.8571    0.8319
     day254         0.0392     235.5    5.6814    0.0191    9.2857    0.9252
     day255         0.0399     209.5    5.7611    0.0208    7.4286    0.8675
     day256         0.0414     296.5    5.6195    0.0208   10.5714     0.827
     day257         0.0379     255.5     5.469    0.0187        12    0.7656
     day258         0.0203      38.5    3.4867    0.0117    7.5714    0.3706
     day259         0.0233        32    2.8407    0.0153    9.8571    0.3951
     day260         0.0341     202.5    5.8053     0.017    8.5714    0.6417
     day261         0.0342       198    5.6991    0.0169    5.1429    0.7104
     day262         0.0358       158    5.9115    0.0189    4.2857    0.7558
     day263          0.035     181.5     5.115    0.0175    4.4286    0.8675
     day264         0.0317     190.5    4.6991    0.0154    4.1429     0.762
     day265         0.0182      25.5    3.3097    0.0104    6.8571    0.3423
     day266         0.0175        24    2.2566      0.01    6.2857    0.4613
     day267         0.0324       170    6.1062    0.0156    9.2857    0.6282
     day268         0.0389     429.5    5.2743    0.0154   10.1429    0.8761
     day269         0.0374     352.5    5.1947    0.0174    6.1429    0.7178
     day270         0.0393       443    5.1593    0.0168    7.2857     0.773
     day271         0.0326     250.5    4.1681    0.0158    6.5714    0.7227
     day272         0.0192        51    3.3097    0.0108    6.2857    0.3571
     day273         0.0187      53.5    3.3628    0.0101    5.7143    0.3644
     day274         0.0317     255.5     5.115    0.0137    7.2857    0.7227
     day275         0.0308       358    5.0354    0.0116    7.2857    0.6098
     day276         0.0281     230.5    4.7788    0.0116    6.7143    0.6515
     day277         0.0282     216.5    4.7434    0.0114   11.4286    0.6883
     day278         0.0249       151    3.9735    0.0102    9.2857     0.719
     day279         0.0145      18.5    3.0265     0.007    7.8571    0.3497
     day280         0.0158      24.5    2.9204    0.0086    7.8571    0.3239
     day281         0.0256     193.5    4.4159    0.0107    8.2857    0.5988
     day282         0.0309       218    5.4867    0.0133    7.4286    0.7067
     day283         0.0292       165    5.1947    0.0131         7    0.6969
     day284         0.0288       186    5.6549    0.0118        10    0.6712
     day285         0.0273       202    5.0796    0.0116    5.2857    0.5963
     day286          0.015        35    2.6991    0.0081    4.5714    0.3178
     day287         0.0137      22.5    2.2832     0.008    6.8571    0.2491
     day288         0.0252       197    4.7965    0.0097    8.1429    0.6037
     day289         0.0281     196.5    4.7434    0.0116    7.2857    0.7276
     day290         0.0255       135    4.8142    0.0114    4.4286    0.6123
     day291         0.0244       153     4.531    0.0103    6.8571    0.5963
     day292         0.0211       160    4.4159    0.0083    5.5714    0.4466
     day293         0.0121      35.5    2.3274    0.0058    7.7143    0.2638
     day294         0.0126      31.5     2.469    0.0059    5.4286    0.3202
     day295          0.022     163.5    4.4956    0.0081    6.2857    0.5521
     day296         0.0241     180.5    4.4602    0.0097    7.2857    0.5706
     day297         0.0267       254    4.7611    0.0094   10.2857    0.6528
     day298         0.0257     233.5    4.2832    0.0099    7.7143    0.6245
     day299         0.0225     161.5    3.9823    0.0092    6.7143    0.5546
     day300         0.0132        57    2.3363    0.0069    4.7143    0.2442
     day301         0.0117        62    2.1593    0.0055    7.1429    0.2172
     day302         0.0175       157    3.1327     0.007    7.1429    0.3485
     day303          0.023     192.5    4.2566    0.0087    7.4286    0.5485
     day304         0.0211     170.5    4.0708     0.008    6.2857    0.5031
     day305         0.0222     161.5    4.4071    0.0083    9.4286    0.5362
     day306         0.0212       182    3.8938    0.0079        10    0.4883
     day307         0.0113        53    1.8142     0.006    6.7143     0.184
     day308         0.0117      24.5    2.1239    0.0069    5.7143    0.1681
     day309         0.0216     158.5    4.4071    0.0087    8.5714    0.4417
     day310         0.0216       178    4.5929    0.0085         6    0.4086
     day311         0.0219       176    4.8407    0.0083    7.5714    0.4319
     day312         0.0209       160    3.4071    0.0087    7.5714    0.4908
     day313         0.0188       152         3    0.0082    7.1429    0.3914
     day314         0.0096        34    2.5575    0.0041         4    0.1767
     day315         0.0108        46         2    0.0052    3.1429    0.2429
     day316         0.0186       142     3.823    0.0071    5.5714    0.4245
     day317         0.0197     160.5    3.5133    0.0074    4.8571    0.5215
     day318         0.0195     135.5    4.2566    0.0081    5.2857    0.3681
     day319         0.0179        92    3.4336    0.0078    8.2857     0.411
     day320         0.0178     115.5    3.3628    0.0074    6.2857    0.4147
     day321         0.0141       224    1.8496    0.0051         5       0.2
     day322         0.0095        25    1.9027    0.0044    3.2857    0.2479
     day323         0.0181      92.5    3.5664     0.008    4.1429    0.4331
     day324         0.0204     170.5    3.7434    0.0079    4.4286    0.4933
     day325         0.0168        82    3.4956    0.0071    5.7143    0.3975
     day326         0.0195       164    3.5133    0.0079    7.2857    0.4086
     day327         0.0173      68.5    3.9204    0.0081    3.7143    0.3411
     day328         0.0101         6    2.5221    0.0049    4.5714    0.2074
     day329         0.0106      14.5    2.6637    0.0054    6.4286    0.1558
     day330          0.018     112.5    3.3363    0.0082    5.2857    0.3718
     day331         0.0182       136    3.9292    0.0072         6    0.3669
     day332         0.0187       215    2.9115     0.007    6.2857    0.3865
     day333         0.0165     102.5    3.2212    0.0073    9.5714    0.3031
     day334         0.0152        67    2.3451     0.008         4    0.3288
     day335         0.0069       3.5    1.2212     0.004         5    0.1202
     day336         0.0082       4.5    1.3717    0.0051    5.2857    0.1202
     day337         0.0151        81    2.9646    0.0073    7.5714    0.2491
     day338         0.0162      96.5    3.0796    0.0073    6.8571    0.3202
     day339         0.0161      95.5    3.1504    0.0073    5.8571    0.3067
     day340         0.0172       156    2.6637    0.0078    5.4286    0.2969
     day341         0.0117      55.5    1.9912    0.0056    6.8571     0.254
     day342         0.0091         8    2.0088    0.0051    4.5714    0.1399
     day343         0.0077       3.5    1.6726    0.0047    4.2857    0.0748
     day344         0.0132     114.5    1.8673    0.0067    5.4286    0.1865
     day345         0.0133      77.5    2.3274    0.0068    6.4286    0.1975
     day346         0.0129        78    2.1947    0.0063    6.4286    0.2184
     day347         0.0141        59    2.6991    0.0077    4.2857    0.1988
     day348         0.0127      82.5    2.1416    0.0066    3.2857    0.1939
     day349         0.0083      60.5    1.2212    0.0043         4    0.1264
     day350          0.007       2.5    0.8761    0.0046    3.4286    0.1276
     day351         0.0117        51    2.1504    0.0061        10    0.1485
     day352         0.0114      77.5     1.531     0.006    5.7143    0.1926
     day353         0.0108      58.5    1.6283    0.0061    5.5714     0.135
     day354         0.0104       9.5    1.4867    0.0071    4.7143    0.1178
     day355         0.0099       1.5    1.2655    0.0072    4.2857    0.0994
     day356         0.0048         2    0.5929    0.0035    3.5714    0.0405
     day357         0.0056       2.5    0.6372    0.0039    3.5714    0.0748
     day358         0.0075         6    0.6372    0.0054    6.1429    0.0982
     day359         0.0094       1.5    0.7965    0.0065   13.8571    0.1104
     day360          0.006         0     0.531    0.0044    3.8571    0.0761
     day361         0.0032         0    0.3717    0.0022         0    0.0712
     day362         0.0005         0         0    0.0003         0    0.0184
     day363         0.0001         0         0         0         0    0.0049




     Time taken to build model (full training data) : 41.47 seconds

     === Model and evaluation on training set ===

     Clustered Instances

     0          2 (  0%)
     1        113 (  0%)
     2      94024 ( 99%)
     3          7 (  0%)
     4        815 (  1%)
     * @param start first index of repos
     * @param max max number of repos
     * @return {@link Instances}
     */
    public Instances genetateActivityInstanceFromDB(int start, int max) {
        return generateActivityInstance(getFullRepoEntities(start, max));
    }

    /**
     * generate punch instances from database
     * @param start first index of repos
     * @param max max number of repos
     * @return {@link Instances}
     */
    public Instances generatePunchInstanceFromDB(int start, int max) {
        return generatePunchInstance(getFullRepoEntities(start, max));
    }

    /**
     * generate owner instances from database
     * @param start first index of repos
     * @param max max number of repos
     * @return {@link Instances}
     */
    public Instances generateOwnerInstanceFromDB(int start, int max) {
        return generateOwnerInstance(getFullRepoEntities(start, max));
    }


    /**
     * generate instances for study (without filter)
     * @return Instances
     */
    private Instances generatePopularInstance(List<SecRepoEntity> entities) {
        //set attributes
        ArrayList<Attribute> attributes = new ArrayList<>();
        attributes.add(new Attribute("fork"));
        attributes.add(new Attribute("size"));
        attributes.add(new Attribute("sum"));
        attributes.add(new Attribute("avg"));
        attributes.add(new Attribute("weight"));
        attributes.add(new Attribute("star"));
        //set instances
        Instances instances = new Instances("repo_popular",attributes,0);
        instances.setClassIndex(instances.numAttributes() - 1);
        //add instance
        for (SecRepoEntity secRepoEntity: entities) {
            Instance instance = new DenseInstance(attributes.size());
            instance.setValue(0,secRepoEntity.getForkCount());
            instance.setValue(1,secRepoEntity.getSize());
            instance.setValue(2,secRepoEntity.getSumFollower());
            instance.setValue(3,secRepoEntity.getAvgFollower());
            instance.setValue(4,secRepoEntity.getWeightFollower());
            instance.setValue(5,secRepoEntity.getStarCount()>50?1:0);
            instances.add(instance);
        }
        return instances;
    }

    /**
     * generate activity instance
     * @param repoEntities repos
     * @return instances
     */
    //[{"days":[0,0,0,0,0,0,0],"total":0,"week":1441497600},{"days":[0,0,0,0,0,0,0],"total":0,"week":1442102400},{"days":[0,0,0,0,0,0,0],"total":0,"week":1442707200},{"days":[0,0,0,0,0,0,0],"total":0,"week":1443312000},{"days":[0,0,0,0,0,0,0],"total":0,"week":1443916800},{"days":[0,0,0,0,0,0,0],"total":0,"week":1444521600},{"days":[0,0,0,0,0,0,0],"total":0,"week":1445126400},{"days":[0,0,0,0,0,0,0],"total":0,"week":1445731200},{"days":[0,0,0,0,0,0,0],"total":0,"week":1446336000},{"days":[0,0,0,0,0,0,0],"total":0,"week":1446940800},{"days":[0,0,0,0,0,0,0],"total":0,"week":1447545600},{"days":[0,0,0,0,0,0,0],"total":0,"week":1448150400},{"days":[0,0,0,0,0,0,0],"total":0,"week":1448755200},{"days":[0,0,0,0,0,0,0],"total":0,"week":1449360000},{"days":[0,0,0,0,0,0,0],"total":0,"week":1449964800},{"days":[0,0,0,0,0,0,0],"total":0,"week":1450569600},{"days":[0,0,0,0,0,0,0],"total":0,"week":1451174400},{"days":[0,0,0,0,0,0,0],"total":0,"week":1451779200},{"days":[0,0,0,0,0,0,0],"total":0,"week":1452384000},{"days":[0,0,0,0,0,0,0],"total":0,"week":1452988800},{"days":[0,0,0,0,0,0,0],"total":0,"week":1453593600},{"days":[0,0,0,0,0,0,0],"total":0,"week":1454198400},{"days":[0,0,0,0,0,0,0],"total":0,"week":1454803200},{"days":[0,0,0,0,0,0,0],"total":0,"week":1455408000},{"days":[0,0,0,0,0,0,0],"total":0,"week":1456012800},{"days":[0,0,0,0,0,0,0],"total":0,"week":1456617600},{"days":[0,0,0,0,0,0,0],"total":0,"week":1457222400},{"days":[0,0,0,0,0,0,0],"total":0,"week":1457827200},{"days":[0,0,0,0,0,0,0],"total":0,"week":1458432000},{"days":[0,0,0,0,0,0,0],"total":0,"week":1459036800},{"days":[0,0,0,0,0,0,0],"total":0,"week":1459641600},{"days":[0,0,0,0,0,0,0],"total":0,"week":1460246400},{"days":[0,0,0,0,0,0,0],"total":0,"week":1460851200},{"days":[0,0,0,0,0,0,0],"total":0,"week":1461456000},{"days":[0,0,0,0,0,0,0],"total":0,"week":1462060800},{"days":[0,0,0,0,0,0,0],"total":0,"week":1462665600},{"days":[0,0,0,0,0,0,0],"total":0,"week":1463270400},{"days":[0,0,0,0,0,0,0],"total":0,"week":1463875200},{"days":[0,0,0,0,0,0,0],"total":0,"week":1464480000},{"days":[0,0,0,0,0,0,0],"total":0,"week":1465084800},{"days":[0,0,0,0,0,0,0],"total":0,"week":1465689600},{"days":[0,0,0,0,0,0,0],"total":0,"week":1466294400},{"days":[0,0,0,0,0,0,0],"total":0,"week":1466899200},{"days":[0,0,0,0,0,0,0],"total":0,"week":1467504000},{"days":[0,0,0,0,0,0,0],"total":0,"week":1468108800},{"days":[0,0,0,0,0,0,0],"total":0,"week":1468713600},{"days":[0,0,0,0,0,0,0],"total":0,"week":1469318400},{"days":[0,0,0,0,0,0,0],"total":0,"week":1469923200},{"days":[0,0,0,0,0,0,0],"total":0,"week":1470528000},{"days":[0,0,0,0,0,0,0],"total":0,"week":1471132800},{"days":[0,0,0,0,0,0,0],"total":0,"week":1471737600},{"days":[0,0,0,0,0,0,0],"total":0,"week":1472342400}]
    private Instances generateActivityInstance(List<SecRepoEntity> repoEntities) {
        ArrayList<Attribute> attributes = new ArrayList<>();
        for (int i = 0; i < 364; i++) {
            attributes.add(new Attribute("day"+i));
        }

        Instances instances = new Instances("repo_activity",attributes,0);
        instances.setClassIndex(instances.numAttributes() - 1);

        for (SecRepoEntity entity: repoEntities) {
            String activity = entity.getActivityJson();
            if (activity!=null && !activity.isEmpty() && activity.contains("[")) {
                JSONArray array = new JSONArray(activity);
                Instance instance = new DenseInstance(attributes.size());
                for (int i = 0; i < array.length(); i++) {
                    JSONArray temp = array.getJSONObject(i).getJSONArray("days");
                    for (int j = 0; j < 7; j++) {
                        instance.setValue(i * 7 + j, temp.getInt(j));
                    }
                }
                instances.add(instance);
            }
        }
        return instances;
    }

    /**
     * generate punch instances
     * @param repoEntities list of repos
     * @return {@link Instances}
     */
    //[[0,0,3],[0,1,0],[0,2,0],[0,3,3],[0,4,0],[0,5,5],[0,6,0],[0,7,0],[0,8,0],[0,9,0],[0,10,0],[0,11,2],[0,12,0],[0,13,2],[0,14,2],[0,15,2],[0,16,3],[0,17,3],[0,18,3],[0,19,0],[0,20,2],[0,21,4],[0,22,4],[0,23,0],[1,0,3],[1,1,0],[1,2,3],[1,3,3],[1,4,0],[1,5,1],[1,6,0],[1,7,0],[1,8,0],[1,9,2],[1,10,3],[1,11,4],[1,12,3],[1,13,0],[1,14,2],[1,15,3],[1,16,1],[1,17,4],[1,18,1],[1,19,2],[1,20,1],[1,21,1],[1,22,0],[1,23,2],[2,0,0],[2,1,1],[2,2,1],[2,3,0],[2,4,0],[2,5,0],[2,6,0],[2,7,0],[2,8,0],[2,9,8],[2,10,6],[2,11,2],[2,12,11],[2,13,1],[2,14,1],[2,15,6],[2,16,10],[2,17,7],[2,18,0],[2,19,1],[2,20,1],[2,21,6],[2,22,7],[2,23,8],[3,0,6],[3,1,2],[3,2,0],[3,3,0],[3,4,0],[3,5,0],[3,6,0],[3,7,0],[3,8,0],[3,9,4],[3,10,2],[3,11,4],[3,12,5],[3,13,8],[3,14,4],[3,15,2],[3,16,3],[3,17,4],[3,18,0],[3,19,3],[3,20,1],[3,21,6],[3,22,4],[3,23,4],[4,0,8],[4,1,3],[4,2,0],[4,3,1],[4,4,0],[4,5,1],[4,6,0],[4,7,0],[4,8,0],[4,9,3],[4,10,5],[4,11,5],[4,12,6],[4,13,5],[4,14,3],[4,15,23],[4,16,7],[4,17,12],[4,18,10],[4,19,2],[4,20,4],[4,21,3],[4,22,1],[4,23,1],[5,0,1],[5,1,2],[5,2,0],[5,3,1],[5,4,0],[5,5,0],[5,6,0],[5,7,0],[5,8,4],[5,9,5],[5,10,1],[5,11,6],[5,12,6],[5,13,9],[5,14,4],[5,15,6],[5,16,5],[5,17,3],[5,18,3],[5,19,3],[5,20,4],[5,21,2],[5,22,5],[5,23,3],[6,0,1],[6,1,2],[6,2,5],[6,3,2],[6,4,2],[6,5,1],[6,6,0],[6,7,2],[6,8,1],[6,9,1],[6,10,1],[6,11,5],[6,12,0],[6,13,1],[6,14,8],[6,15,6],[6,16,9],[6,17,1],[6,18,1],[6,19,6],[6,20,5],[6,21,0],[6,22,0],[6,23,4]]
    private Instances generatePunchInstance(List<SecRepoEntity> repoEntities) {
        ArrayList<Attribute> attributes = new ArrayList<>();
        for (int i = 0; i < 7; i++) {
            for (int j = 0; j < 24; j++) {
                attributes.add(new Attribute("d"+i+"w"+j));
            }
        }
        Instances instances = new Instances("repo_punch", attributes, 0);
        instances.setClassIndex(instances.numAttributes()-1);
        for (SecRepoEntity repoEntity: repoEntities) {
            String punch = repoEntity.getPunchJson();
            if (punch!=null && !punch.isEmpty() && punch.contains("[")) {
                JSONArray jsonArray = new JSONArray(punch);
                Instance instance = new DenseInstance(attributes.size());
                for (int i = 0; i < jsonArray.length(); i++) {
                    instance.setValue(i,jsonArray.getJSONArray(i).getInt(2));
                }
                instances.add(instance);
            }
        }
        return instances;
    }

    //{"all":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"owner":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}
    private Instances generateOwnerInstance(List<SecRepoEntity> repoEntities) {
        ArrayList<Attribute> attributes = new ArrayList<>();
        for (int i = 0; i < 52; i++) {
            attributes.add(new Attribute("all"+i));
        }
        for (int i = 0; i < 52; i++) {
            attributes.add(new Attribute("owner"+i));
        }
        Instances instances = new Instances("repo_owner",attributes,0);
        instances.setClassIndex(instances.numAttributes() - 1);
        for (SecRepoEntity repoEntity: repoEntities) {
            String owner = repoEntity.getWeeklyJson();
            Instance instance = new DenseInstance(attributes.size());
            if (owner!=null && !owner.isEmpty() && owner.contains("{")) {
                JSONObject object = new JSONObject(owner);
                JSONArray array = object.getJSONArray("all");
                for (int i = 0; i < array.length(); i++) {
                    instance.setValue(i,array.getInt(i));
                }
                JSONArray array1 = object.getJSONArray("owner");
                for (int i = 0; i < array1.length(); i++) {
                    instance.setValue(i+52, array1.getInt(i));
                }
            }
            instances.add(instance);
        }
        return instances;
    }

    private List<SecRepoEntity> getRepoEntities(int start, int max) {
        Session session = sessionFactory.openSession();
        List<SecRepoEntity> entities = null;
        Query query = session.createQuery(" from SecRepoEntity where createAt<'2014-07-05' ");
        query.setMaxResults(max);
        query.setFirstResult(start);
        entities = query.list();
        session.close();
        return entities;
    }

    private List<SecRepoEntity> getFullRepoEntities(int start, int max) {
        Session session = sessionFactory.openSession();
        List<SecRepoEntity> entities = null;
        Query query = session.createQuery(" from SecRepoEntity ");
        query.setFirstResult(start);
        query.setMaxResults(max);
        entities = query.list();
        session.close();
        return entities;
    }

}
